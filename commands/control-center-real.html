<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DopeMAN - Skills Control Center (Real Data)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-icon {
            font-size: 2em;
            margin-right: 12px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .card-count {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .card-label {
            font-size: 0.9em;
            color: #666;
        }

        .main-panel {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .panel-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .filter-btn:hover {
            background: #667eea;
            color: white;
        }

        .tree-view {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .tree-item {
            padding: 6px 12px;
            margin: 2px 0;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .tree-item:hover {
            background: #f5f5f5;
        }

        .tree-node {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tree-indent {
            margin-left: 24px;
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-team { background: #10b981; }
        .status-single { background: #3b82f6; }
        .status-coordinator { background: #f59e0b; }
        .status-worker { background: #8b5cf6; }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .badge.team { background: #10b981; }
        .badge.single { background: #3b82f6; }
        .badge.coordinator { background: #f59e0b; }
        .badge.worker { background: #8b5cf6; }

        .tab-container {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            font-weight: 500;
        }

        .tab:hover {
            background: #f5f5f5;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        .expandable {
            cursor: pointer;
        }

        .expandable::before {
            content: 'â–¶ ';
            display: inline-block;
            transition: transform 0.2s;
        }

        .expandable.expanded::before {
            transform: rotate(90deg);
        }

        .collapsed {
            display: none;
        }

        /* Dev Projects Styles */
        .project-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            transition: all 0.2s;
        }

        .project-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .project-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .project-type-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .project-type-work {
            background: #3b82f6;
            color: white;
        }

        .project-type-own-dev {
            background: #10b981;
            color: white;
        }

        .project-type-github-ref {
            background: #8b5cf6;
            color: white;
        }

        .project-type-other {
            background: #6b7280;
            color: white;
        }

        .project-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .project-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tech-stack {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .tech-badge {
            padding: 2px 8px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.8em;
            color: #4b5563;
        }

        .project-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .action-btn {
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background 0.2s;
            text-decoration: none;
        }

        .action-btn:hover {
            background: #5568d3;
        }

        .action-btn-secondary {
            background: white;
            color: #667eea;
            border: 1px solid #667eea;
        }

        .action-btn-secondary:hover {
            background: #f5f5f5;
        }

        /* è¨­å®šé é¢æ¨£å¼ */
        .settings-section {
            background: white;
            padding: 0;
        }

        .settings-section h3 {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .editor-tool-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .editor-tool-option:hover {
            background: #e8e9ea;
            border-color: #667eea;
        }

        .editor-tool-option.selected {
            background: #e8eaf6;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .editor-tool-option input[type="radio"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .editor-tool-icon {
            font-size: 24px;
            margin-right: 12px;
        }

        .editor-tool-info {
            flex: 1;
        }

        .editor-tool-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .editor-tool-protocol {
            font-size: 0.85em;
            color: #666;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .editor-tool-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-switch.enabled {
            background: #10b981;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.2s;
        }

        .toggle-switch.enabled::after {
            left: 22px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ Skills Control Center</h1>
            <p>çœŸå¯¦è³‡æ–™è¦–è¦ºåŒ– - å®Œæ•´ç’°å¢ƒæƒæçµæœ</p>
        </div>

        <!-- çµ±è¨ˆå„€è¡¨æ¿ -->
        <div class="dashboard" id="dashboard">
            <!-- å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <!-- ä¸»é¢æ¿ -->
        <div class="main-panel">
            <div class="panel-title">
                <span>ğŸ“Š è©³ç´°è³‡è¨Š</span>
                <span style="font-size: 0.6em; font-weight: normal; color: #999;">
                    æœ€å¾Œæƒæ: <span id="lastScan"></span>
                </span>
            </div>

            <!-- æœå°‹æ¡† -->
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="æœå°‹ Skills, Agents, Rules, Commands...">
            </div>

            <!-- éæ¿¾æŒ‰éˆ• -->
            <div class="filter-buttons" id="filterButtons">
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <!-- æ¨™ç±¤é  -->
            <div class="tab-container">
                <div class="tab active" data-tab="skills">Skills</div>
                <div class="tab" data-tab="agents">Agents</div>
                <div class="tab" data-tab="rules">Rules</div>
                <div class="tab" data-tab="commands">Commands</div>
                <div class="tab" data-tab="dev-projects">Dev Projects</div>
                <div class="tab" data-tab="layers">åˆ†å±¤è¦–åœ–</div>
                <div class="tab" data-tab="settings">âš™ï¸ è¨­å®š</div>
            </div>

            <!-- æ¨™ç±¤é å…§å®¹ -->
            <div id="skills" class="tab-content active">
                <div class="tree-view" id="skillsTree"></div>
            </div>

            <div id="agents" class="tab-content">
                <div class="tree-view" id="agentsTree"></div>
            </div>

            <div id="rules" class="tab-content">
                <div class="tree-view" id="rulesTree"></div>
            </div>

            <div id="commands" class="tab-content">
                <div class="tree-view" id="commandsTree"></div>
            </div>

            <div id="dev-projects" class="tab-content">
                <div class="tree-view" id="devProjectsTree"></div>
            </div>

            <div id="layers" class="tab-content">
                <div class="tree-view" id="layersTree"></div>
            </div>

            <div id="settings" class="tab-content">
                <div style="padding: 20px; max-width: 800px;">
                    <h2 style="margin-top: 0; color: #667eea;">âš™ï¸ ç”¨æˆ¶è¨­å®š</h2>

                    <div class="settings-section">
                        <h3>é è¨­ç·¨è¼¯å™¨</h3>
                        <p style="color: #666; margin-bottom: 15px;">é¸æ“‡é»æ“Šã€ŒOpenã€æŒ‰éˆ•æ™‚ä½¿ç”¨çš„å·¥å…·</p>

                        <div id="editorToolsContainer" style="display: flex; flex-direction: column; gap: 12px;">
                            <!-- å‹•æ…‹ç”Ÿæˆç·¨è¼¯å™¨é¸é … -->
                        </div>

                        <button onclick="saveSettings()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ å„²å­˜è¨­å®š
                        </button>
                        <span id="saveStatus" style="margin-left: 15px; color: #10b981; display: none;">âœ“ å·²å„²å­˜</span>
                    </div>

                    <div class="settings-section" style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #e0e0e0;">
                        <h3>æ–°å¢è‡ªè¨‚å·¥å…·</h3>
                        <p style="color: #666; margin-bottom: 15px;">æ“´å……å·¥å…·åº«ï¼ŒåŠ å…¥æ‚¨å¸¸ç”¨çš„ç·¨è¼¯å™¨æˆ–é–‹ç™¼å·¥å…·</p>

                        <div style="display: grid; grid-template-columns: 1fr 2fr 2fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <input type="text" id="newToolIcon" placeholder="ğŸ¯" maxlength="2" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center; font-size: 20px;">
                            <input type="text" id="newToolName" placeholder="å·¥å…·åç¨±" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <input type="text" id="newToolProtocol" placeholder="protocol://file" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <button onclick="addCustomTool()" style="padding: 8px 15px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                â• æ–°å¢
                            </button>
                        </div>

                        <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 13px; color: #666;">
                            <strong>ç¯„ä¾‹ï¼š</strong><br>
                            â€¢ WebStorm: <code>webstorm://open?file=</code><br>
                            â€¢ IntelliJ IDEA: <code>idea://open?file=</code><br>
                            â€¢ Sublime Text: <code>subl://open?file=</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>DopeMAN v1.0.0 | Skills Control Center</p>
            <p style="font-size: 0.9em; margin-top: 8px;">æ™ºèƒ½ç’°å¢ƒç®¡ç†ç§˜æ›¸åœ˜éšŠ</p>
        </div>
    </div>

    <script>
        let data = null;
        let filteredData = null;

        // è¼‰å…¥è³‡æ–™
        async function loadData() {
            try {
                const response = await fetch('./control-center-real-data.json');
                data = await response.json();
                filteredData = data;
                renderAll();
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
            }
        }

        // æ¸²æŸ“æ‰€æœ‰å…§å®¹
        function renderAll() {
            renderDashboard();
            renderSkillsTree();
            renderAgentsTree();
            renderRulesTree();
            renderCommandsTree();
            renderDevProjectsTree();
            renderLayersTree();
            renderSettings();
            renderFilters();

            // æ›´æ–°æœ€å¾Œæƒææ™‚é–“
            const lastScan = new Date(data.last_scan);
            document.getElementById('lastScan').textContent = lastScan.toLocaleString('zh-TW');
        }

        // æ¸²æŸ“å„€è¡¨æ¿
        function renderDashboard() {
            const dashboard = document.getElementById('dashboard');
            const cards = [
                {
                    icon: 'ğŸŒ',
                    title: 'å…¨åŸŸ Skills',
                    count: data.categories.global_skills.count,
                    label: 'å·²å®‰è£çš„å…¨åŸŸæŠ€èƒ½'
                },
                {
                    icon: 'ğŸ“',
                    title: 'å°ˆæ¡ˆ Skills',
                    count: data.categories.project_skills.count,
                    label: 'å°ˆæ¡ˆç‰¹å®šæŠ€èƒ½'
                },
                {
                    icon: 'ğŸ”¨',
                    title: 'é–‹ç™¼ä¸­ Skills',
                    count: data.categories.dev_skills.count,
                    label: 'æœ‰ Git Repo çš„æŠ€èƒ½'
                },
                {
                    icon: 'ğŸ“‹',
                    title: 'å…¨åŸŸ Rules',
                    count: data.categories.global_rules.count,
                    label: 'å…¨åŸŸè¦å‰‡'
                },
                {
                    icon: 'ğŸ“‚',
                    title: 'å°ˆæ¡ˆ Rules',
                    count: data.categories.project_rules.count,
                    label: 'å°ˆæ¡ˆè¦å‰‡'
                },
                {
                    icon: 'ğŸ¤–',
                    title: 'Agents',
                    count: data.categories.agents.count,
                    label: 'Coordinators & Workers'
                },
                {
                    icon: 'âŒ¨ï¸',
                    title: 'Commands',
                    count: data.categories.commands.count,
                    label: 'å¯ç”¨æŒ‡ä»¤'
                },
                {
                    icon: 'ğŸ’»',
                    title: 'Dev Projects',
                    count: data.categories.dev_projects.count,
                    label: 'é–‹ç™¼å°ˆæ¡ˆ'
                }
            ];

            dashboard.innerHTML = cards.map(card => `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">${card.icon}</div>
                        <div class="card-title">${card.title}</div>
                    </div>
                    <div class="card-count">${card.count}</div>
                    <div class="card-label">${card.label}</div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“ Skills æ¨¹ç‹€åœ–
        function renderSkillsTree() {
            const tree = document.getElementById('skillsTree');
            const globalSkills = data.categories.global_skills.items;
            const projectSkills = data.categories.project_skills.items;
            const devSkills = data.categories.dev_skills.items;

            let html = '';

            // å…¨åŸŸ Skills
            html += `<div class="tree-item">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸŒ å…¨åŸŸ Skills</span>
                    <span class="badge">${globalSkills.length}</span>
                </div>
            </div>`;

            globalSkills.slice(0, 20).forEach(skill => {
                const type = skill.type === 'team' ? 'team' : 'single';
                html += `<div class="tree-item tree-indent">
                    <div class="tree-node">
                        <span class="status-dot status-${type}"></span>
                        <span>${skill.name}</span>
                        <span class="badge ${type}">${skill.type}</span>
                    </div>
                </div>`;
            });

            if (globalSkills.length > 20) {
                html += `<div class="tree-item tree-indent">
                    <div class="tree-node" style="color: #999;">
                        ... é‚„æœ‰ ${globalSkills.length - 20} å€‹
                    </div>
                </div>`;
            }

            // å°ˆæ¡ˆ Skills
            html += `<div class="tree-item" style="margin-top: 20px;">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ“ å°ˆæ¡ˆ Skills</span>
                    <span class="badge">${projectSkills.length}</span>
                </div>
            </div>`;

            const projectGroups = {};
            projectSkills.forEach(skill => {
                if (!projectGroups[skill.project_path]) {
                    projectGroups[skill.project_path] = [];
                }
                projectGroups[skill.project_path].push(skill);
            });

            Object.entries(projectGroups).slice(0, 5).forEach(([project, skills]) => {
                html += `<div class="tree-item tree-indent">
                    <div class="tree-node expandable" onclick="toggleExpand(this)">
                        <span>ğŸ“‚ ${project}</span>
                        <span class="badge">${skills.length}</span>
                    </div>
                </div>`;

                skills.forEach(skill => {
                    html += `<div class="tree-item collapsed" style="margin-left: 48px;">
                        <div class="tree-node">
                            <span class="status-dot status-single"></span>
                            <span>${skill.skill_name}</span>
                            ${skill.is_duplicate ? '<span class="badge" style="background: #ef4444;">é‡è¤‡</span>' : ''}
                        </div>
                    </div>`;
                });
            });

            // é–‹ç™¼ä¸­ Skills
            if (devSkills.length > 0) {
                html += `<div class="tree-item" style="margin-top: 20px;">
                    <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                        <span>ğŸ”¨ é–‹ç™¼ä¸­ Skills</span>
                        <span class="badge">${devSkills.length}</span>
                    </div>
                </div>`;

                devSkills.forEach(skill => {
                    html += `<div class="tree-item tree-indent">
                        <div class="tree-node">
                            <span class="status-dot status-team"></span>
                            <span>${skill.name}</span>
                            ${skill.dirty ? '<span class="badge" style="background: #f59e0b;">æœªæäº¤</span>' : ''}
                        </div>
                    </div>`;
                });
            }

            tree.innerHTML = html;
        }

        // æ¸²æŸ“ Agents æ¨¹ç‹€åœ–
        function renderAgentsTree() {
            const tree = document.getElementById('agentsTree');
            const agents = data.categories.agents.items;

            const coordinators = agents.filter(a => a.type === 'coordinator');
            const workers = agents.filter(a => a.type === 'worker');

            let html = '';

            // Coordinators
            html += `<div class="tree-item">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ¯ Coordinators</span>
                    <span class="badge coordinator">${coordinators.length}</span>
                </div>
            </div>`;

            coordinators.forEach(coord => {
                html += `<div class="tree-item tree-indent">
                    <div class="tree-node">
                        <span class="status-dot status-coordinator"></span>
                        <span>${coord.name}</span>
                        <span style="color: #999; font-size: 0.85em; margin-left: 8px;">
                            â†’ ${coord.belongs_to_project}
                        </span>
                    </div>
                </div>`;
            });

            // Workers
            html += `<div class="tree-item" style="margin-top: 20px;">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ‘· Workers</span>
                    <span class="badge worker">${workers.length}</span>
                </div>
            </div>`;

            const workerGroups = {};
            workers.forEach(worker => {
                if (!workerGroups[worker.group]) {
                    workerGroups[worker.group] = [];
                }
                workerGroups[worker.group].push(worker);
            });

            Object.entries(workerGroups).forEach(([group, groupWorkers]) => {
                html += `<div class="tree-item tree-indent">
                    <div class="tree-node expandable" onclick="toggleExpand(this)">
                        <span>ğŸ“ ${group}</span>
                        <span class="badge">${groupWorkers.length}</span>
                    </div>
                </div>`;

                groupWorkers.forEach(worker => {
                    html += `<div class="tree-item collapsed" style="margin-left: 48px;">
                        <div class="tree-node">
                            <span class="status-dot status-worker"></span>
                            <span>${worker.name}</span>
                        </div>
                    </div>`;
                });
            });

            tree.innerHTML = html;
        }

        // æ¸²æŸ“ Rules æ¨¹ç‹€åœ–
        function renderRulesTree() {
            const tree = document.getElementById('rulesTree');
            const globalRules = data.categories.global_rules.items;
            const projectRules = data.categories.project_rules.items;

            let html = '';

            // å…¨åŸŸ Rules
            html += `<div class="tree-item">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸŒ å…¨åŸŸ Rules</span>
                    <span class="badge">${globalRules.length}</span>
                </div>
            </div>`;

            globalRules.forEach(rule => {
                html += `<div class="tree-item tree-indent">
                    <div class="tree-node">
                        <span>ğŸ“‹ ${rule.name}</span>
                        ${rule.applicability.length > 0 ?
                            `<span style="color: #999; font-size: 0.85em; margin-left: 8px;">
                                â†’ ${rule.applicability.join(', ')}
                            </span>` : ''}
                    </div>
                </div>`;
            });

            // å°ˆæ¡ˆ Rules
            html += `<div class="tree-item" style="margin-top: 20px;">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ“ å°ˆæ¡ˆ Rules</span>
                    <span class="badge">${projectRules.length}</span>
                </div>
            </div>`;

            const ruleGroups = {};
            projectRules.forEach(rule => {
                if (!ruleGroups[rule.project_path]) {
                    ruleGroups[rule.project_path] = [];
                }
                ruleGroups[rule.project_path].push(rule);
            });

            Object.entries(ruleGroups).forEach(([project, rules]) => {
                html += `<div class="tree-item tree-indent">
                    <div class="tree-node expandable" onclick="toggleExpand(this)">
                        <span>ğŸ“‚ ${project}</span>
                        <span class="badge">${rules.length}</span>
                    </div>
                </div>`;

                rules.forEach(rule => {
                    html += `<div class="tree-item collapsed" style="margin-left: 48px;">
                        <div class="tree-node">
                            <span>ğŸ“‹ ${rule.name}</span>
                        </div>
                    </div>`;
                });
            });

            tree.innerHTML = html;
        }

        // æ¸²æŸ“ Commands æ¨¹ç‹€åœ–
        function renderCommandsTree() {
            const tree = document.getElementById('commandsTree');
            const commands = data.categories.commands.items;

            let html = '';

            commands.forEach(cmd => {
                html += `<div class="tree-item">
                    <div class="tree-node">
                        <span style="font-weight: 600; color: #667eea;">${cmd.full_command}</span>
                    </div>
                    <div class="tree-node tree-indent" style="color: #666;">
                        ${cmd.description}
                    </div>
                </div>`;
            });

            tree.innerHTML = html;
        }

        // æ¸²æŸ“ Dev Projects å¡ç‰‡
        function renderDevProjectsTree() {
            const tree = document.getElementById('devProjectsTree');
            const projects = data.categories.dev_projects.items;

            if (projects.length === 0) {
                tree.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">å°šç„¡é–‹ç™¼å°ˆæ¡ˆ</div>';
                return;
            }

            let html = '';

            projects.forEach(project => {
                // å°ˆæ¡ˆé¡å‹æ¨™ç±¤
                const typeClass = `project-type-${project.type}`;
                const typeLabel = {
                    'work': 'å·¥ä½œå°ˆæ¡ˆ',
                    'own-dev': 'å€‹äººé–‹ç™¼',
                    'github-ref': 'GitHub åƒè€ƒ',
                    'other': 'å…¶ä»–'
                }[project.type] || project.type;

                // æŠ€è¡“æ£§æ¨™ç±¤
                const techStackHtml = project.tech_stack.length > 0
                    ? project.tech_stack.map(tech => `<span class="tech-badge">${tech}</span>`).join('')
                    : '<span style="color: #999; font-size: 0.85em;">æœªåµæ¸¬åˆ°æŠ€è¡“æ£§</span>';

                // Git ç‹€æ…‹
                const gitStatus = project.is_dirty
                    ? '<span style="color: #f59e0b;">â— æœªæäº¤</span>'
                    : '<span style="color: #10b981;">âœ“ ä¹¾æ·¨</span>';

                // Claude Team ç‹€æ…‹
                const claudeTeam = project.has_claude_team
                    ? '<span style="color: #667eea;">âœ“ Claude Team</span>'
                    : '<span style="color: #999;">ï¼</span>';

                // æœ€å¾Œ commit è³‡è¨Š
                const lastCommit = project.last_commit_date
                    ? `${new Date(project.last_commit_date).toLocaleDateString('zh-TW')}`
                    : 'ç„¡';

                const commitMsg = project.last_commit_message
                    ? project.last_commit_message.substring(0, 60) + (project.last_commit_message.length > 60 ? '...' : '')
                    : '';

                html += `
                    <div class="project-card">
                        <div class="project-header">
                            <div class="project-name">ğŸ’» ${project.name}</div>
                            <div class="project-type-badge ${typeClass}">${typeLabel}</div>
                        </div>

                        <div class="project-meta">
                            <div class="project-meta-item">
                                <span>ğŸ“</span>
                                <span>${project.path}</span>
                            </div>
                        </div>

                        <div class="tech-stack">
                            <span style="font-weight: 600; color: #666; font-size: 0.85em;">æŠ€è¡“æ£§:</span>
                            ${techStackHtml}
                        </div>

                        <div class="project-meta">
                            <div class="project-meta-item">
                                <span>ğŸ”€ Git:</span>
                                ${gitStatus}
                            </div>
                            <div class="project-meta-item">
                                <span>ğŸ¤–</span>
                                ${claudeTeam}
                            </div>
                            <div class="project-meta-item">
                                <span>ğŸ“… æœ€å¾Œæäº¤:</span>
                                <span>${lastCommit}</span>
                            </div>
                        </div>

                        ${commitMsg ? `
                        <div style="font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
                            "${commitMsg}"
                        </div>
                        ` : ''}

                        <div class="project-actions">
                            <a href="${getEditorUrl(project.path)}" class="action-btn">
                                ${(() => {
                                    const defaultEditor = data.user_preferences?.default_editor || 'vscode';
                                    const tool = data.user_preferences?.editor_tools?.find(t => t.id === defaultEditor);
                                    return tool ? tool.icon : 'ğŸ“‚';
                                })()} Open
                            </a>
                            ${project.remote_url && !project.remote_url.includes('D12CuS8TyU456') ? `
                            <a href="${project.remote_url}" target="_blank" class="action-btn action-btn-secondary">
                                ğŸ”— Git Remote
                            </a>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            tree.innerHTML = html;
        }

        // æ¸²æŸ“è¨­å®šé é¢
        function renderSettings() {
            if (!data.user_preferences || !data.user_preferences.editor_tools) {
                return;
            }

            const container = document.getElementById('editorToolsContainer');
            const editorTools = data.user_preferences.editor_tools;
            const defaultEditor = data.user_preferences.default_editor || 'vscode';

            let html = '';

            editorTools.forEach(tool => {
                const checked = tool.id === defaultEditor ? 'checked' : '';
                const selected = tool.id === defaultEditor ? 'selected' : '';
                const enabledClass = tool.enabled ? 'enabled' : '';

                html += `
                    <div class="editor-tool-option ${selected}" onclick="selectEditor('${tool.id}')">
                        <input type="radio" name="defaultEditor" value="${tool.id}" ${checked} onclick="event.stopPropagation();">
                        <div class="editor-tool-icon">${tool.icon}</div>
                        <div class="editor-tool-info">
                            <div class="editor-tool-name">${tool.name}</div>
                            <div class="editor-tool-protocol">${tool.protocol}</div>
                        </div>
                        <div class="editor-tool-toggle" onclick="event.stopPropagation(); toggleEditorTool('${tool.id}')">
                            <div class="toggle-switch ${enabledClass}" id="toggle-${tool.id}"></div>
                            <span>${tool.enabled ? 'å•Ÿç”¨' : 'åœç”¨'}</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // é¸æ“‡é è¨­ç·¨è¼¯å™¨
        function selectEditor(toolId) {
            // æ›´æ–°è¦–è¦ºç‹€æ…‹
            document.querySelectorAll('.editor-tool-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // æ›´æ–° radio é¸æ“‡
            const radio = event.currentTarget.querySelector('input[type="radio"]');
            if (radio) radio.checked = true;

            // æ›´æ–°è³‡æ–™
            data.user_preferences.default_editor = toolId;
        }

        // åˆ‡æ›å·¥å…·å•Ÿç”¨/åœç”¨
        function toggleEditorTool(toolId) {
            const tool = data.user_preferences.editor_tools.find(t => t.id === toolId);
            if (tool) {
                tool.enabled = !tool.enabled;
                renderSettings();
            }
        }

        // å„²å­˜è¨­å®š
        async function saveSettings() {
            try {
                // é¡¯ç¤ºè¼‰å…¥ä¸­
                const saveBtn = event.target;
                const statusSpan = document.getElementById('saveStatus');
                saveBtn.disabled = true;
                saveBtn.textContent = 'å„²å­˜ä¸­...';

                // æº–å‚™è¦å„²å­˜çš„è³‡æ–™
                const preferencesData = {
                    version: "1.0.0",
                    last_updated: new Date().toISOString(),
                    preferences: data.user_preferences
                };

                // ä½¿ç”¨ Python è…³æœ¬å„²å­˜ï¼ˆå› ç‚ºç€è¦½å™¨ç„¡æ³•ç›´æ¥å¯«æª”æ¡ˆï¼‰
                // å¯¦éš›ä¸Šé€™è£¡éœ€è¦ä¸€å€‹ API endpoint ä¾†è™•ç†å„²å­˜
                // æš«æ™‚åªæ›´æ–°æœ¬åœ°è³‡æ–™å’Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯
                console.log('å„²å­˜è¨­å®š:', preferencesData);

                // TODO: å¯¦ä½œå¯¦éš›çš„å„²å­˜åŠŸèƒ½ï¼ˆéœ€è¦å¾Œç«¯ APIï¼‰
                // å¯èƒ½çš„è§£æ±ºæ–¹æ¡ˆï¼š
                // 1. ä½¿ç”¨ Python HTTP server æä¾› POST endpoint
                // 2. ä½¿ç”¨ localStorage æš«å­˜ï¼ˆä½†éœ€è¦é‡æ–°æƒææ™‚å¯«å›æª”æ¡ˆï¼‰

                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                statusSpan.style.display = 'inline';
                saveBtn.textContent = 'ğŸ’¾ å„²å­˜è¨­å®š';
                saveBtn.disabled = false;

                setTimeout(() => {
                    statusSpan.style.display = 'none';
                }, 2000);

                alert('è¨­å®šå·²æ›´æ–°ï¼\\n\\næ³¨æ„ï¼šç›®å‰è¨­å®šåƒ…åœ¨æœ¬æ¬¡ Dashboard æœƒè©±ä¸­ç”Ÿæ•ˆã€‚\\nè‹¥è¦æ°¸ä¹…ä¿å­˜ï¼Œè«‹ä¿®æ”¹ï¼š\\n~/.claude/memory/dopeman/user-preferences.json');
            } catch (error) {
                console.error('å„²å­˜è¨­å®šå¤±æ•—:', error);
                alert('å„²å­˜è¨­å®šå¤±æ•—ï¼è«‹æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯ã€‚');
            }
        }

        // æ–°å¢è‡ªè¨‚å·¥å…·
        function addCustomTool() {
            const iconInput = document.getElementById('newToolIcon');
            const nameInput = document.getElementById('newToolName');
            const protocolInput = document.getElementById('newToolProtocol');

            const icon = iconInput.value.trim() || 'ğŸ”§';
            const name = nameInput.value.trim();
            const protocol = protocolInput.value.trim();

            if (!name || !protocol) {
                alert('è«‹å¡«å¯«å·¥å…·åç¨±å’Œé€šè¨Šå”å®šï¼');
                return;
            }

            // ç”Ÿæˆ ID
            const id = name.toLowerCase().replace(/\s+/g, '-');

            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (data.user_preferences.editor_tools.find(t => t.id === id)) {
                alert('æ­¤å·¥å…·å·²å­˜åœ¨ï¼è«‹ä½¿ç”¨ä¸åŒçš„åç¨±ã€‚');
                return;
            }

            // æ–°å¢å·¥å…·
            data.user_preferences.editor_tools.push({
                id: id,
                name: name,
                protocol: protocol,
                enabled: true,
                icon: icon
            });

            // æ¸…ç©ºè¼¸å…¥
            iconInput.value = '';
            nameInput.value = '';
            protocolInput.value = '';

            // é‡æ–°æ¸²æŸ“
            renderSettings();

            alert(`å·¥å…·ã€Œ${name}ã€å·²æ–°å¢ï¼\\nè¨˜å¾—é»æ“Šã€Œå„²å­˜è¨­å®šã€ä¾†ä¿å­˜è®Šæ›´ã€‚`);
        }

        // å–å¾—ç•¶å‰é¸æ“‡çš„ç·¨è¼¯å™¨ URL
        function getEditorUrl(path) {
            if (!data.user_preferences || !data.user_preferences.editor_tools) {
                return `vscode://file${path}`;
            }

            const defaultEditor = data.user_preferences.default_editor || 'vscode';
            const tool = data.user_preferences.editor_tools.find(t => t.id === defaultEditor && t.enabled);

            if (!tool) {
                return `vscode://file${path}`;
            }

            return `${tool.protocol}${path}`;
        }

        // æ¸²æŸ“åˆ†å±¤è¦–åœ–
        function renderLayersTree() {
            const tree = document.getElementById('layersTree');
            const layers = data.layers;

            let html = '';

            // Entry Layer
            html += `<div class="tree-item">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ“ Entry Layer (å…¥å£å±¤)</span>
                </div>
            </div>`;

            html += `<div class="tree-item tree-indent">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>âŒ¨ï¸ Commands</span>
                    <span class="badge">${layers.entry.commands.length}</span>
                </div>
            </div>`;

            layers.entry.commands.forEach(cmd => {
                html += `<div class="tree-item" style="margin-left: 48px;">
                    <div class="tree-node">
                        <span>${cmd}</span>
                    </div>
                </div>`;
            });

            // Coordination Layer
            html += `<div class="tree-item" style="margin-top: 20px;">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ“ Coordination Layer (å”èª¿å±¤)</span>
                </div>
            </div>`;

            html += `<div class="tree-item tree-indent">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ¯ Coordinators</span>
                    <span class="badge coordinator">${layers.coordination.coordinators.length}</span>
                </div>
            </div>`;

            layers.coordination.coordinators.forEach(coord => {
                html += `<div class="tree-item" style="margin-left: 48px;">
                    <div class="tree-node">
                        <span class="status-dot status-coordinator"></span>
                        <span>${coord}</span>
                    </div>
                </div>`;
            });

            // Execution Layer
            html += `<div class="tree-item" style="margin-top: 20px;">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ“ Execution Layer (åŸ·è¡Œå±¤)</span>
                </div>
            </div>`;

            html += `<div class="tree-item tree-indent">
                <div class="tree-node expandable expanded" onclick="toggleExpand(this)">
                    <span>ğŸ‘· Workers</span>
                    <span class="badge worker">${layers.execution.workers.length}</span>
                </div>
            </div>`;

            layers.execution.workers.forEach(worker => {
                html += `<div class="tree-item" style="margin-left: 48px;">
                    <div class="tree-node">
                        <span class="status-dot status-worker"></span>
                        <span>${worker}</span>
                    </div>
                </div>`;
            });

            tree.innerHTML = html;
        }

        // æ¸²æŸ“éæ¿¾æŒ‰éˆ•
        function renderFilters() {
            const filters = document.getElementById('filterButtons');
            // æš«æ™‚ç•™ç©ºï¼Œä¹‹å¾Œå¯ä»¥åŠ å…¥éæ¿¾åŠŸèƒ½
        }

        // åˆ‡æ›å±•é–‹/æ‘ºç–Š
        function toggleExpand(element) {
            element.classList.toggle('expanded');
            let sibling = element.parentElement.nextElementSibling;
            while (sibling && sibling.classList.contains('tree-indent') ||
                   (sibling && sibling.classList.contains('collapsed'))) {
                sibling.classList.toggle('collapsed');
                sibling = sibling.nextElementSibling;
            }
        }

        // æ¨™ç±¤é åˆ‡æ›
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰ active
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // å•Ÿç”¨ç•¶å‰æ¨™ç±¤
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // æœå°‹åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            // TODO: å¯¦ä½œæœå°‹éæ¿¾
        });

        // åˆå§‹åŒ–
        loadData();
    </script>
</body>
</html>
