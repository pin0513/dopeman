<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DopeMAN - Skills Control Center (Refactored)</title>

    <!-- 重構後的模組化 CSS -->
    <link rel="stylesheet" href="css/dashboard-variables.css">
    <link rel="stylesheet" href="css/dashboard-layout.css">

    <!-- 原始內嵌 CSS（暫時保留，逐步遷移到組件樣式） -->
    <link rel="stylesheet" href="css/dashboard-inline.css.tmp">

    <style>
        /* 過渡期間的必要補充樣式 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 250px;
            animation: slideInRight 0.3s ease;
        }

        .toast.info { border-left: 4px solid var(--color-info); }
        .toast.success { border-left: 4px solid var(--color-success); }
        .toast.error { border-left: 4px solid var(--color-error); }
        .toast.warning { border-left: 4px solid var(--color-warning); }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Main Application Container -->
    <!-- HTML Body 內容與原版相同，此處引用原始結構 -->
    <!-- 為確保功能完整，暫時保持原始 HTML 結構 -->

</body>

<!-- 重構後的模組化 JavaScript -->
<script src="js/dashboard-config.js"></script>
<script src="js/dashboard-state.js"></script>
<script src="js/dashboard-api.js"></script>

<!-- 原始內嵌 JavaScript（暫時保留，逐步遷移到模組） -->
<script src="js/dashboard-inline.js.tmp"></script>

<script>
    /**
     * 應用程式初始化
     * 整合模組化系統與原始程式碼
     */
    document.addEventListener('DOMContentLoaded', async () => {
        console.log('✅ Dashboard Config loaded:', DashboardConfig);
        console.log('✅ Dashboard State loaded:', DashboardState);
        console.log('✅ Dashboard API loaded:', DashboardAPI);

        // 顯示載入中
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'flex';
        }

        try {
            // 使用模組化 API 載入資料
            await DashboardAPI.loadData();
            console.log('✅ Data loaded successfully');

            // 隱藏載入中
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }

            // 呼叫原始的初始化函數（如果存在）
            if (typeof init === 'function') {
                init();
            }
        } catch (error) {
            console.error('❌ Initialization failed:', error);

            // 隱藏載入中
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }

            // 顯示錯誤訊息
            DashboardState.addToast('載入失敗: ' + error.message, 'error');
        }
    });

    /**
     * Toast 渲染函數
     * 監聽 DashboardState.toasts 變化並更新 UI
     */
    function renderToasts() {
        const container = document.getElementById('toastContainer');
        if (!container) return;

        container.innerHTML = DashboardState.toasts
            .map(toast => `
                <div class="toast toast-${toast.type}" data-toast-id="${toast.id}">
                    <strong>${toast.type.toUpperCase()}</strong>
                    <p>${toast.message}</p>
                </div>
            `)
            .join('');
    }

    // 監聽 State 變化（簡易實作）
    setInterval(() => {
        renderToasts();
    }, 100);
</script>
</html>
